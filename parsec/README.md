Программа состоит из набора инструкций, разделённых переносами строк. Инструкция может быть арифметическим выражением, условным выражением, циклом, присваиванием или вводом/выводом выражения. По обе стороны от инструкции также может быть произвольное количество пробельных символов.

Пробельные символы важны: ими обязательно разделяются все ключевые слова и операторы. Блоки кода в условном выражении и цикле обязательно обрамляются фигурными скобками. Но отступы опциональны.

Идентификаторы представляют собой строки из латинских букв и цифр, содержащие хотя бы одну букву (необязательно в начале). Числа представляют собой ненулевой набор цифр, возможно с предшествующими плюсами и минусами (в произвольном количестве и порядке, лишь бы без пробелов между ними, итоговое значение рассчитывается по чётности количества минусов, плюсы не имеют значения).

Арифметические выражения состоят из бинарных операторов, идентификаторов и чисел, также есть группировка круглыми скобками. Бинарные операторы имеют стандартный вид, за исключением `%` (целочисленное деление), `~` (равно), `!` (не равно), `<~` (меньше или равно), `~>` (больше или равно). Операторы имеют следующие приоритеты и ассоциативности (в порядке уменьшения приоритета):

| Оператор | Ассоциативность |
|----------|-----------------|
| `^`        | Правая |
| `*`, `%`      | Левая |
| `+`, `-`      | Левая |
| `<~`, `<`, `>~`, `>` | Не ассоциативны |
| `~`, `!` | Не ассоциативны |

Условное выражение имеет вид `? ... { ... } : { ... }`, цикл имеет вид `@ ... { ... }`. Ввод/вывод выглядит как `>> ...` и `<< ...`. Присваивание имеет вид `id { ... }`. 

```
program = ( statement '\n' )* ;

statement = expr
          | if
          | while
          | read
          | write
          | assignment
          | space* statement space*
          ;

if = '?' spaces expr spaces '{' spaces program spaces '}'
   | '?' spaces expr spaces '{' spaces program spaces '}' spaces ':' spaces '{' spaces program spaces '}'
   ;

while = '@' spaces expr spaces '{' spaces program spaces '}' ;

read = '>>' spaces id ;

write = '<<' spaces expr ;

assignment = id whitespaces '{' spaces expr spaces '}' ;

expr = id 
     | number
     | '(' spaces expr spaces ')'
     | expr whitespaces binop whitespaces expr
     ;

alpha = [a-zA-Z] ;
digit = [0-9] ;

number = digit+ | '-' number | '+' number ;

id = ( alpha | digit )* alpha ( alpha | digit )* ;

binop = '^' | '*' | '%' | '+' | '-' | '~' | '!' | '<~' | '<' | '~>' | '>' ;

whitespace = ' ' | '\t' ;
whitespaces = whitespace+;

space = whitespace | '\n' ;
spaces = space+ ;
```

